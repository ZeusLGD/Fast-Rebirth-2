local player = game.Players.LocalPlayer
local muscleEvent = player:WaitForChild("muscleEvent")
local replicatedStorage = game:GetService("ReplicatedStorage")

_G.fastGrindActive = false

-- Função: Remover todos os pets
local function unequipPets()
    for _, folder in pairs(player.petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                replicatedStorage.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.1)
end

-- Função: Equipar pets pelo nome
local function equipPetsByName(name)
    unequipPets()
    task.wait(0.01)
    for _, pet in pairs(player.petsFolder.Unique:GetChildren()) do
        if pet.Name == name then
            replicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", pet)
        end
    end
end

-- Encontrar o assento da Jungle Bar Lift
local function getJungleBarLiftSeat()
    local machines = workspace:FindFirstChild("machinesFolder")
    if machines then
        local lift = machines:FindFirstChild("Jungle Bar Lift")
        if lift then
            return lift:FindFirstChild("interactSeat")
        end
    end
    return nil
end

-- Alternativa segura para celular
local function sitCharacter()
    local humanoid = player.Character and player.Character:FindFirstChildWhichIsA("Humanoid")
    if humanoid then
        humanoid.Sit = true
    end
end

-- Loop principal
local function fastTrainAndRebirthLoop()
    while _G.fastGrindActive do
        equipPetsByName("Swift Samurai")

        local rebirths = player.leaderstats.Rebirths.Value
        local strengthTarget = 10000 + (rebirths * 5000)
        if player.ultimatesFolder:FindFirstChild("Golden Rebirth") then
            local golden = player.ultimatesFolder["Golden Rebirth"].Value
            strengthTarget = math.floor(strengthTarget * (1 - (golden * 0.1)))
        end

        local seat = getJungleBarLiftSeat()
        if seat then
            player.Character.HumanoidRootPart.CFrame = seat.CFrame * CFrame.new(0, 3, 0)
            sitCharacter()
            task.wait(0.5)
        end

        while player.leaderstats.Strength.Value < strengthTarget and _G.fastGrindActive do
            for _ = 1, 10 do
                muscleEvent:FireServer("rep")
            end
            task.wait(0.01)
        end

        if not _G.fastGrindActive then break end

        equipPetsByName("Tribal Overlord")
        task.wait(0.2)

        local before = player.leaderstats.Rebirths.Value
        repeat
            replicatedStorage.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
            task.wait(0.1)
        until player.leaderstats.Rebirths.Value > before or not _G.fastGrindActive

        task.wait(0.5)
    end
end

-- Função global para iniciar
_G.startFastGrind = function()
    if not _G.fastGrindActive then
        _G.fastGrindActive = true
        task.spawn(fastTrainAndRebirthLoop)
    end
end
